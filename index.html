<!DOCTYPE html>
<html lang="en">

<head>
    <title>Trials in Tainted Space Save Editor</title>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="scripts/filesaver.js"></script>

    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap-mod.css" />

    <style>
    </style>

    <script>
        var loaded_save = {};

        $(() => {
            $('#btnDisclaimer').on('click', () => {
                $('#divDisclaimer').hide();
                doLoad();
            });
        });

        function doLoad() {
            $('#loadFile').on('change', () => {
                const input = $('#inputLoadFile');
                if (!input.files || input.files.length == 0) {
                    alert('Error loading the file, please try again.');
                }
                else {

                }
            });

            window.initialFileName = 'unnamed';
            $('#inputSaveFileName').on('focus', () => {
                const input = $('#inputSaveFileName');
                const val = input.val();
                const fileExtension = input.attr('accept');
                if (val.lastIndexOf(fileExtension) == val.length - 5) {
                    input.val(val.substring(0, val.lastIndexOf(fileExtension)));
                }
            });

            $('#inputSaveFileName').on('blur', () => {
                const input = $('#inputSaveFileName');
                const requiredLength = 1;
                const val = input.val();
                const fileExtension = input.attr('accept');
                if (val.length >= requiredLength) {
                    input.val(val + fileExtension);
                }
                else {
                    input.val(window.initialFileName + fileExtension);
                    alert('File name must be ' + requiredLength + ' character' + (requiredLength > 1 ? 's' : '') + ' or longer');
                }
            });

            $('#btnSaveFile').on('click', () => {
                const blob = new Blob([JSON.stringify(loaded_save)], { type: 'text/json' });
                const fileExtension = $('#inputSaveFileName').attr('accept');
                var fileName = $('#inputSaveFileName').val();
                if (!fileName) {
                    fileName = "unnamed" + fileExtension;
                }
                saveAs(blob, fileName);
            });

            $('#divContent').show();
        }
    </script>
</head>

<body class="bg-secondary">
    <div id="divDisclaimer" class="container-fluid text-center p-3 text-light">
        <h1 class="display-4 text-light">TiTS Save Editor</h1>
        <p>Edit saves at your own risk. If you break or corrupt your savefile don't blame the editor!</p>
        <p>Only JavaScript version save files are supported.</p>

        <br /><br />

        <div>
            <h1 class="display-6">This project is still in development</h1>
            <p>
                Although this page is published, in its current state it is not usable, still, you can track its progress through Github. If you
                have any issue, suggestion, or feature request please post them in the Issues tab on the Github, I'll do my best to look through
                those.
            </p>
        </div>

        <button id="btnDisclaimer" type="button" class="btn btn-info mt-5">Continue</button>
    </div>

    <div id="divContent" class="container-fluid" style="display:none;">
        <div class="bg-info fixed-top text-light">
            <div class="row m-2">   
                <div class="col-auto mr-auto">
                    <div>
                        <input type="text" class="form-control" id="inputSaveFileName" accept=".json" minlength="5" />
                    </div>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-primary" onclick="inputLoadFile.click()">Load file</button>
                    <input class="form-control" type="file" accept=".json" id="inputLoadFile" hidden="hidden">
                </div>
                <div class="col-auto">
                    <button id="btnSaveFile" type="button" class="btn btn-primary">Save file</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>